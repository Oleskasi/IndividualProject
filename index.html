<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –ö–æ–ª–æ–±–∫–∞</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      touch-action: none;
    }
    body {
      background: linear-gradient(180deg, #79cbff, #feffba);
      background-size: cover;
      font-family: 'Arial', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    canvas {
      background: transparent;
      border: 3px solid rgba(0,0,0,0.4);
      border-radius: 15px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
      max-width: 100%;
    }
    #restartButton {
      display: none;
      margin-top: 20px;
      padding: 12px 24px;
      background: #FF6347;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    #restartButton:active {
      transform: scale(0.95);
    }
    #touchJumpButton {
      display: none;
      margin-top: 20px;
      padding: 15px 30px;
      background: rgba(0,0,0,0.5);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      cursor: pointer;
      touch-action: manipulation;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <button id="touchJumpButton">ü¶ò –ü—Ä—ã–∂–æ–∫</button>
  <button id="restartButton">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const restartButton = document.getElementById('restartButton');
    const touchJumpButton = document.getElementById('touchJumpButton');

    // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä canvas
    function resizeCanvas() {
      canvas.width = window.innerWidth > 800 ? 800 : window.innerWidth * 0.95;
      canvas.height = window.innerHeight > 400 ? 400 : window.innerHeight * 0.5;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–∑–∏–∫–∏
    const gravity = 0.6;
    let jumpStrength = -12;
    let gameOver = false;

    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
    let gameSpeed = 1;
    const speedIncreaseInterval = 10000;
    let lastSpeedIncreaseTime = 0;

    // –°—á–µ—Ç –∏ –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    let score = 0;
    let highScore = localStorage.getItem('highScore') || 0;

    // –û–±—ä–µ–∫—Ç –ö–æ–ª–æ–±–∫–∞ 
    const kolobok = {
      x: 100,
      y: canvas.height - 50,
      width: 50,
      height: 50,
      velocityY: 0,
      isJumping: false,
      reset: function() {
        this.x = 100;
        this.y = canvas.height - this.height - 10;
        this.velocityY = 0;
        this.isJumping = false;
      },
      draw: function() {
        const centerX = this.x + this.width / 2;
        const centerY = this.y + this.height / 2;
        
        // –û–±—ä–µ–º–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
        const gradient = ctx.createRadialGradient(
          centerX, centerY, this.width * 0.1, 
          centerX, centerY, this.width / 2
        );
        gradient.addColorStop(0, '#fff50a');
        gradient.addColorStop(0.7, '#f7ff66');
        gradient.addColorStop(1, '#fff50a');
        
        ctx.shadowBlur = 10;
        ctx.shadowColor = 'rgba(0,0,0,0.3)';
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(centerX, centerY, this.width / 2, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;

        // –ì–ª–∞–∑–∞ —Å –±–ª–µ—Å–∫–æ–º
        ctx.fillStyle = '#FFFFFF';
        ctx.beginPath();
        ctx.arc(this.x + this.width * 0.35, this.y + this.height * 0.4, 5, 0, Math.PI * 2);
        ctx.arc(this.x + this.width * 0.65, this.y + this.height * 0.4, 5, 0, Math.PI * 2);
        ctx.fill();

        ctx.fillStyle = '#000';
        ctx.beginPath();
        ctx.arc(this.x + this.width * 0.35, this.y + this.height * 0.4, 2, 0, Math.PI * 2);
        ctx.arc(this.x + this.width * 0.65, this.y + this.height * 0.4, 2, 0, Math.PI * 2);
        ctx.fill();
      },
      update: function() {
        this.y += this.velocityY;
        if (this.y + this.height < canvas.height - 10) {
          this.velocityY += gravity;
          this.isJumping = true;
        } else {
          this.y = canvas.height - this.height - 10;
          this.velocityY = 0;
          this.isJumping = false;
        }
      },
      jump: function() {
        if (!this.isJumping) {
          this.velocityY = jumpStrength;
          this.isJumping = true;
        }
      }
    };

    // –ú–∞—Å—Å–∏–≤ —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∏—Ö –ø–æ—è–≤–ª–µ–Ω–∏—è
    let obstacles = [];
    let obstacleTimer = 0;
    let obstacleInterval = 1500;
    let lastTime = 0;

    // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è —Å —Ä–∞–Ω–¥–æ–º–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏
    function createObstacle() {
      const size = Math.random() * (60 - 20) + 20;
      const obstacle = {
        x: canvas.width,
        y: canvas.height - size - 10,
        width: size,
        height: size,
        speed: 5 * gameSpeed,
        scored: false,
        draw: function() {
          const gradient = ctx.createLinearGradient(this.x, this.y, this.x + this.width, this.y + this.height);
          gradient.addColorStop(0, '#808080');
          gradient.addColorStop(1, '#708090');
          ctx.fillStyle = gradient;
          ctx.fillRect(this.x, this.y, this.width, this.height);
        }
      };
      obstacles.push(obstacle);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
    function updateObstacles(deltaTime) {
      obstacles.forEach(obstacle => {
        obstacle.x -= obstacle.speed;
        if (!obstacle.scored && obstacle.x + obstacle.width < kolobok.x) {
          score++;
          obstacle.scored = true;
        }
      });
      obstacles = obstacles.filter(obstacle => obstacle.x + obstacle.width > 0);

      obstacleTimer += deltaTime;
      if (obstacleTimer > obstacleInterval) {
        createObstacle();
        obstacleTimer = 0;
      }
    }

    function drawObstacles() {
      obstacles.forEach(obstacle => {
        obstacle.draw();
      });
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è "–∑–µ–º–ª–∏"
    function drawGround() {
      ctx.fillStyle = '#8B4513';
      ctx.fillRect(0, canvas.height - 10, canvas.width, 10);
    }

    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—á–∫–æ–≤ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
    function drawScore() {
 // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç
 const gradient = ctx.createLinearGradient(10, 10, 10, 60);
  gradient.addColorStop(0, '#FF6B6B');
  gradient.addColorStop(1, '#4ECDC4');

  ctx.font = 'bold 24px Arial';
  ctx.fillStyle = gradient;
  ctx.textAlign = 'right'; // –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é

  ctx.fillText(`–û—á–∫–∏: ${score}`, canvas.width - 10, 30); // –£–≤–µ–ª–∏—á–µ–Ω –æ—Ç—Å—Ç—É–ø x
  ctx.fillText(`–õ—É—á—à–∏–π: ${highScore}`, canvas.width - 10, 60); // –£–≤–µ–ª–∏—á–µ–Ω –æ—Ç—Å—Ç—É–ø x
}

    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –¥–≤—É—Ö –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤
    function checkCollision(rect1, rect2) {
      return (
        rect1.x < rect2.x + rect2.width &&
        rect1.x + rect1.width > rect2.x &&
        rect1.y < rect2.y + rect2.height &&
        rect1.y + rect1.height > rect2.y
      );
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π –ö–æ–ª–æ–±–∫–∞ —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏
    function checkGameOver() {
      for (let obstacle of obstacles) {
        if (checkCollision(kolobok, obstacle)) {
          gameOver = true;
          break;
        }
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏–≥—Ä—ã
    function updateGameDifficulty(timestamp) {
      if (timestamp - lastSpeedIncreaseTime > speedIncreaseInterval) {
        gameSpeed += 0.2;
        
        // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
        obstacles.forEach(obstacle => {
          obstacle.speed = 5 * gameSpeed;
        });
        
        // –£–º–µ–Ω—å—à–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –ø–æ—è–≤–ª–µ–Ω–∏—è –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
        obstacleInterval = Math.max(obstacleInterval * 0.9, 500);
        
        // –£—Å–ª–æ–∂–Ω–µ–Ω–∏–µ —Ñ–∏–∑–∏–∫–∏
        jumpStrength = -12 + (gameSpeed - 1) * -0.5;
        
        lastSpeedIncreaseTime = timestamp;
      }
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∑–∞—Å—Ç–∞–≤–∫–∏ –ø—Ä–∏ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –∏–≥—Ä—ã
    function displayGameOver() {
      ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#fff';
      ctx.font = '48px sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏', canvas.width / 2, canvas.height / 2 - 40);
      restartButton.style.display = 'block';

      if (score > highScore) {
        highScore = score;
        localStorage.setItem('highScore', highScore);
      }
    }

    // –ì–ª–∞–≤–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
    function gameLoop(timestamp) {
      if (!lastTime) lastTime = timestamp;
      const deltaTime = timestamp - lastTime;
      lastTime = timestamp;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawGround();
      kolobok.update();
      kolobok.draw();
      updateObstacles(deltaTime);
      drawObstacles();
      drawScore();
      updateGameDifficulty(timestamp);
      checkGameOver();

      if (!gameOver) {
        requestAnimationFrame(gameLoop);
      } else {
        displayGameOver();
      }
    }

    // –ú–æ–±–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    function setupMobileControls() {
      touchJumpButton.style.display = 'block';
      touchJumpButton.addEventListener('touchstart', (e) => {
        e.preventDefault();
        kolobok.jump();
      });

      document.addEventListener('touchmove', (e) => {
        e.preventDefault();
      }, { passive: false });
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    function isMobileDevice() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã
    function restartGame() {
      restartButton.style.display = 'none';
      gameOver = false;
      obstacles = [];
      obstacleTimer = 0;
      lastTime = 0;
      score = 0;
      gameSpeed = 1;
      obstacleInterval = 1500;
      jumpStrength = -12;
      kolobok.reset();
      requestAnimationFrame(gameLoop);
    }


    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
      kolobok.jump();
    }, { passive: false });

    document.body.addEventListener('touchstart', (e) => {
      // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫, –µ—Å–ª–∏ —É–∂–µ –∫–ª–∏–∫–Ω—É–ª–∏ –ø–æ canvas
      if (e.target !== canvas) {
        kolobok.jump();
      }
    });


    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    window.addEventListener('keydown', function(e) {
      if (e.code === 'Space' || e.code === 'ArrowUp') {
        kolobok.jump();
      }
    });

    

    restartButton.addEventListener('click', restartGame);

    // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.onload = () => {
      if (isMobileDevice()) {
        setupMobileControls();
      }
      requestAnimationFrame(gameLoop);
    };
  </script>
</body>
</html>
